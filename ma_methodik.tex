\chapter{Methodik}

\section{Time Delay Stability}\label{TDS}

Das Verfahren der \acs{TDS} stellt eine bivariate, lineare Methode zur Untersuchung multivariater Biosignalaufzeichnungen und zur Bestimmung von Korrelationen zweier Biosignale innerhalb eines Netzwerks dar. Die mittels \acs{PSG} aufgezeichneten Signale stellen hierbei die einzelnen Knoten des Netzwerks dar und repräsentieren jeweils eigenständige physiologische Systeme, die innerhalb des Netzwerks interagieren. Auf diese Weise können Aussagen über die Netztopologie sowie die Verbindungsstärke jeweils zweier Systeme getroffen werden. Diese Merkmale werden in Abhängigkeit der jeweiligen Schlafstadien untersucht. Als Schlafstadien gelten der Wachzustand, \acs{REM}-Schlaf und Tiefschlaf (\acs{NREM}3 und \acs{NREM}4 zusammengefasst) gemäß \acs{AASM} sowie der Leichtschlaf in Form des Schlafstadiums \acs{NREM}2. Das Schlafstadium \acs{NREM}1 wird hierbei außer Acht gelassen, da dieses als Übergang zwischen Wachzustand und Leichtschlaf (\acs{NREM}2) gilt. \parencite{bashan_network_2012, iber_aasm_2007}\\

Die Bestimmung einer Korrelation zwischen zwei Systemen erfolgt auf Basis der Kreuzkorrelation, jedoch werden zur Berechnung der Korrelationsstärke nicht die Kreuzkorrelationskoeffizienten verwendet, sondern die Zeit, über welche die Werte der maximalen Koeffizienten konstant sind. Im Folgenden wird beschrieben, in welcher Weise die zu untersuchenden Signale vorverarbeitet werden müssen und wie die Korrelationen anhand der \acs{TDS}-Analyse anschließend ermittelt werden. Auf die Implementierung dieses Verfahrens wird in Kapitel \ref{Implementierung} eingegangen.

%TODO:
%Bartsch et al. verwendet anderes edge handling (anschauen)! aber hier TDS Methode von Dagmar verwenden, damit die Ergebnisse vergleichbar sind

\subsection{Datenvorverarbeitung}\label{datenvorverarbeitung}

Da die Biosignale zum einen sehr unterschiedliche Merkmale aufweisen (vgl. Abb. \ref{fig:beispiel-psg}), zum anderen mit uneinheitlichen Abtastraten aufgezeichnet werden können und darüber hinaus die Kreuzkorrelation maßgeblich von den Signalwerten (Amplituden) abhängt, muss zunächst eine Vergleichbarkeit der Daten herbeigeführt werden. Zu diesem Zweck werden Zeitreihen extrahiert, welche im Ergebnis homogene Merkmale aufweisen.

%\textbf{\acs{EEG}}
\paragraph{\acs{EEG}}
Auf jedes zu untersuchende \acs{EEG}-Signal wird zunächst eine Spektralanalyse mit einer Fensterung von 2 s und einer Überlappung von 1 s ausgeführt, um das Signal vom Zeit- in den Frequenzbereich zu überführen. Anschließend werden die charakteristischen Frequenzbänder (vgl. Kapitel \ref{psg}) extrahiert. Um die einzelnen Frequenzbänder möglichst eindeutig voneinander trennen zu können, werden gemäß Bashan et al. die Übergänge auf 0.5 Hz genau definiert (Tab. \ref{tab:frequenzen}). Es resultieren demnach für ein \acs{EEG}-Signal insgesamt fünf Zeitreihen mit einer Abtastfrequenz von 1 Hz. \parencite{bashan_network_2012}\\


\begin{table}[H] 
\centering
\begin{small}
\begin{tabular}{lc}
\toprule
\multicolumn{1}{l}{\textbf{Frequenzband}} & \multicolumn{1}{c}{\textbf{Frequenz in Hz}}\\  
\midrule
Delta-Wellen & 0.5 Hz - 3.5 Hz\\
Theta-Wellen & 4 Hz - 7.5 Hz\\
Alpha-Wellen & 8 Hz - 11.5 Hz\\
Sigma-Wellen & 12 Hz - 15.5 Hz\\
Beta-Wellen & 16 Hz - 19,5 Hz\\
\bottomrule
\end{tabular}
\caption[Frequenzbänder des \acs{EEG}]{Frequenzbänder des \acs{EEG} gemäß \parencite{bashan_network_2012}}
\label{tab:frequenzen}
\end{small}
\end{table}


\paragraph{\acs{EOG} und \acs{EMG}}
Aus \acs{EOG}- und \acs{EMG}-Signalen wird innerhalb von 2 s langen Fenstern mit einer Überlappung von 1 s die Varianz ermittelt und als Zeitreihe gespeichert.\parencite{bashan_network_2012}\\

\paragraph{\acs{EKG} und Atmung}
Zu den Atemsignalen zählen nasale Atmung sowie die Atemanstrengung in Brust und Bauch. Zur Extraktion homogener Zeitreihen aus \acs{EKG} und Atmung werden Herz- und Atemfrequenz berechnet und auf 1 Hz neu gesampelt. \parencite{bashan_network_2012}\\

Sämtliche extrahierte Zeitreihen weisen demnach eine identische Auflösung von 1 Hz mit gleicher Länge $N$ auf. Bei der Untersuchung der Korrelation zweier Zeitreihen $x$ und $y$ werden diese anschließend in $N_L$ sich überlappende Segmente $v$ eingeteilt. Jedes Segment $v$ weist eine Länge von 60 s bei einer Überlappung von 30 s auf (Formel~\ref{eq:zeitreihen}). Sodann erfolgt eine Normalisierung der Zeitreihen, so dass der Mittelwert 0 und die Standardabweichung 1 betragen. Auf diese Weise sind sämtliche Merkmale der ursprünglichen Signale homogenisiert und zwecks Ermittlung von Korrelationen vorverarbeitet.\parencite{bashan_network_2012}

\begin{equation}
L = 60 s \nonumber
\end{equation}
\begin{equation}
overlap = \frac{L}{2} \nonumber
\end{equation}
\begin{equation}
N_L = (2\frac{N}{L})-1
	\label{eq:zeitreihen}
\end{equation}

\subsection{Ermittlung von Korrelationen}\label{korrelationen}

Über zwei Zeitreihen $x$ und $y$ wird die Kreuzkorrelation durchgeführt, indem die eine Zeitreihe $x$ segmentweise und innerhalb jedes Segments $v$ sekundenweise über die zweite Zeitreihe $y$ geschoben wird. Für jeden Zeitpunkt der Verschiebung $T$ wird eine Zwischensumme der Kreuzkorrelation berechnet, wobei die entsprechenden Werte beider Zeitreihen miteinander multipliziert und anschließend alle Produkte addiert werden. Demnach entsteht für jeden Zeitpunkt der Verschiebung $T$ ein Eintrag in den Ergebnisvektor $xcorr$: \parencite{bashan_network_2012}

\begin{equation}
xcorr(x_v, y_v)(T) = \sum \limits_{i=1}^L x_v(i) \cdot y_v(T+i).
	\label{eq:xcorr}
\end{equation}

Der maximale Absolutwert innerhalb des Vektors $xcorr$ stellt in seinem Wert die höchstmögliche Ähnlichkeit der Zeitreihen und in seiner Position die Verschiebung $T$ zum Zeitpunkt dieser maximalen Korrelation dar. Für jedes Segment $v$ wird sodann die Verschiebung $T_0$ (Time Delay) zum maximalen Absolutwert aus dem Kreuzkorrelationsvektor $xcorr$ bestimmt. Als stabile Verbindungen gelten mindestens vier zusammenhängende Segmente $v$ (5 $*$ 30 s), deren Verschiebung $T_0$ annähernd gleich ($\pm$ 1~s) bleibt (Abb. \ref{fig:TimeDelay}). Je länger diese zusammenhängenden Epochen andauern, desto stabiler ist die Verbindung zwischen den beiden untersuchten Systemen. Anschließend wird der Prozentsatz der TDS im Verhältnis zur gesamten Zeitreihe berechnet. Je höher dieser Prozentanteil ausfällt, desto größer ist die Verbindungsstärke. Hierbei gilt ein Schwellenwert (Significance Threshold) von 7 \%, ab dem zwei Systeme tatsächlich als verbunden gelten. \parencite{bashan_network_2012}

\begin{figure}[H]
	\centering
	\includegraphics[scale = 0.5]{img/Time_Delay.png}
	\caption[Zeitverschiebung (Time Delay) und stabile Verbindungen im \acs{TDS}-Verfahren]{Zeitverschiebung (Time Delay) und stabile Verbindungen im \acs{TDS}-Verfahren innerhalb eines physiologischen Netzwerks (unter Verwendung von \parencite{bashan_network_2012}):\\jeder Punkt steht für den Time Delay $T$ einer 30 s Epoche; fünf zusammenhängende 30 s Epochen mit stabilem Time Delay $T$ entsprechen vier zusammenhängenden Segmenten $v$;\\gelbe Punkte = stabile Verbindung zwischen Kinn-\acs{EMG} und Alpha-Wellen des \acs{EEG};\\rote Punkte = stabile Verbindung zwischen \acs{EKG} und \acs{EOG}; blaue Punkte = keine stabile Verbindung}
	\label{fig:TimeDelay}
\end{figure}

Auf diese Weise werden sämtliche Zeitreihen des Netzwerks miteinander verglichen. Im Ergebnis der \acs{TDS}-Analyse entsteht für jedes untersuchte Schlafstadium eine quadratische Matrix, welche die prozentualen Verbindungsstärken zwischen den Systemen farbig abbildet. Beispielhaft sind die Ergebnismatrizen für gesunde Probanden aus der Untersuchung von Krefting et al. \parencite{krefting_altersabhangigkeit_2016} (388 \acs{PSG}s aus der SIESTA-Studie) für jedes untersuchte Schlafstadium in der Abb. \ref{fig:TDS_Matrizen} dargestellt. Deutlich erkennbar ist hierbei die Ähnlichkeit zwischen Wachzustand und Leichtschlaf sowie zwischen Tief- und \acs{REM}-Schlaf. In den Zeilen und Spalten der Matrizen sind sämtliche untersuchten Systeme in gleicher Reihenfolge abgetragen (Herz, nasale Atmung, Atemanstrengung in Brust und Bauch, Kinn- und Beinbewegung, Augen sowie die jeweils fünf Frequenzbänder der sechs \acs{EEG}s). Dementsprechend stellt das obere rechte Dreieck die Spiegelung des unteren linken Dreiecks dar. Die Diagonale bildet die Autokorrelation der Systeme ab.\\

Das Verfahren der TDS stellt demnach ein Werkzeug zur Untersuchung der physiologischen Zusammenhänge im Schlaf dar. Hierbei ist jedoch nicht der Wert des Kreuzkorrelationskoeffizienten ausschlaggebend, sondern die Dauer der Korrelation. Auf diese Weise können nicht nur zeitgleiche, sondern auch zeitversetzte Ähnlichkeiten zweier Signale erkannt werden. \parencite{bashan_network_2012}

\begin{figure}[H]
	\centering
	\includegraphics[width = \textwidth]{img/TDS_W_LS_DS_REM.png}
	\caption[Ergebnis-Matrizen der \acs{TDS}]{Gemittelte Ergebnis-Matrizen der \acs{TDS}-Analyse für den Wachzustand, Leichtschlaf (oben), Tiefschlaf und \acs{REM}-Schlaf (unten) über die Kontrollgruppe der SIESTA-Studie (388 \acs{PSG}s):\\Verbindungsstärken sämtlicher Signalkopplungen in Prozent entsprechend der Colorbar; die abfallende Diagonale stellt die Autokorrelation der Systeme dar;\\$HR$ = Herz, $BR_{air}$ = nasaler Atemfluss, $BR_c$ = Atemanstrengung in der Brust, $BR_a$ = Atemanstrengung im Bauch, $Chin$ = Kinnbewegung, $Leg$ = Beinbewegung, $Eye1$ und $Eye2$ = Augen, $\delta$, $\theta$, $\alpha$, $\sigma$, $\beta$ = Frequenzbänder der frontopolaren ($Fp1$, $Fp2$), zentralen ($C3$, $C4$) und okzipitalen ($O1$, $O2$) Elektroden}
	\label{fig:TDS_Matrizen}
\end{figure}

\newpage

\section{Mittelwertberechnung}

gmean, smean, nmean

\section{Lineare Regression}

Das Ziel der linearen Regression ist die Vorhersage einer Zielgröße anhand bekannter Variablen. Diese Vorhersage beruht zum einen auf unabhängigen Werten $x_i$ und zum anderen auf von $x_i$ abhängigen Werten $y_i$. $x$ und $y$ stellen demnach Messreihen dar, wobei $y$ von $x$ abhängt. Ein einfaches Beispiel stellt die Schuhgröße in Abhängigkeit zur Körpergröße dar. Die Wertpaare lassen sich als Punktwolke grafisch darstellen. Die lineare Regression stellt hierbei ein statistisches Werkzeug zur Bestimmung einer idealen Regressionslinie durch die Punktwolke gemäß

\begin{equation}
y = a + b \cdot x + \epsilon
	\label{eq:linreg}
\end{equation}

dar mit $y$ als abhängige Zielgröße, der unabhängigen Variablen $x$, der Konstanten $a$ als Schnittpunkt mit der y-Achse, dem Regressionskoeffizienten $b$ sowie einem Fehlerwert $\epsilon$. Der Regressionskoeffizient wird anhand der einzelnen Werte in den Messreihen sowie deren Mittelwerte gemäß

\begin{equation}
b = \frac{\sum \limits_{i=1}^n(x_i-\overline{x}) \cdot (y_i-\overline{y})}{\sum \limits_{i=1}^n(x_i-\overline{x})^2} 
	\label{eq:regcoef}
\end{equation}

berechnet, wobei $\overline{x}$ und $\overline{y}$ die jeweiligen Mittelwerte der Messreihen darstellen. Die Konstante $a$ wird anschließend anhand von 

\begin{equation}
a = \overline{y} - b \cdot \overline{x}
	\label{eq:konstante}
\end{equation}

berechnet. Mit Hilfe von $a$ und $b$ kann demnach für jedes $x$ eine Vorhersage für den Zielwert $y$ getroffen werden. Da der Zielwert meist Schwankungen unterliegt, definiert $\epsilon$ den Fehlerwert. \parencite{frank_einfach_2006}\\

In einem linearen Modell wird zunächst eine Null-Hypothese aufgestellt 

\begin{equation}
H_0: b = 0.
	\label{eq:null-hypo}
\end{equation}

In dem Beispiel der Körper- und Schuhgröße würde dies bedeuten, dass die Körpergröße keinen Einfluss auf die Schuhgröße hat. Der p-Wert gibt darüber hinaus die Signifikanz der Korrelation an. Je näher der p-Wert dem Wert 0 ist, desto höher ist die Signifikanz. Ein p-Wert, der größer als 0,05 ist beschreibt keine signifikante Korrelation der Variablen.  

\section{Korrelationsverfahren}

Korrelationsverfahren dienen zur Messung des Zusammenhangs zweier Variablen. Mit Hilfe des Korrelationskoeffizienten nach Pearson wird der lineare Zusammenhang zweier Messreihen $x$ und $y$ ermittelt durch

\begin{equation}
r =  \frac{\sum \limits_{i=1}^n (x_i-\overline{x}) \cdot (y_i-\overline{y})}{\sqrt{\sum \limits_{i=1}^n (x_i-\overline{x})^2} \cdot \sqrt{\sum \limits_{i=1}^n (y_i-\overline{y})^2}}.
	\label{eq:pearson}
\end{equation}

Der Korrelationskoeffizient nach Spearman, auch Rangkorrelation genannt, wird nicht anhand der Messwerte, sondern anhand ihrer Ränge berechnet. Hierzu wird für jeden Wert beider Messreihen ein Rang vergeben in der Form, dass beispielsweise die höchste Körpergröße den Rang 1 erhält und die geringste den letzten Rang innerhalb der Messreihe. Für die Messreihe der Schuhgröße erfolgt die Rangvergabe nach identischem Muster, so dass die größte Schuhgröße den Rang 1 und die kleinste den letzten Rang der Messreihe erhält. Bei der grafischen Darstellung dieser Ränge geht der Zusammenhang der vorherigen Messwertpaare demnach verloren. Berechnet wird die Rangkorrelation in gleicher Weise wie der Korrelationskoeffizient nach Pearson, jedoch werden die Messwerte $x_i$ und $y_i$ durch ihre Ränge ersetzt, so dass 

\begin{equation}
r_{Sp} =  \frac{\sum \limits_{i=1}^n (Rang(x_i)-\overline{Rang(x)}) \cdot (Rang(y_i)-\overline{Rang(y)})}{\sqrt{\sum \limits_{i=1}^n (Rang(x_i)-\overline{Rang(x)})^2} \cdot \sqrt{\sum \limits_{i=1}^n (Rang(y_i)-\overline{Rang(y)})^2}}
	\label{eq:spearman}
\end{equation}

gilt. Demnach wird mit Hilfe des Korrelationskoeffizienten nach Spearman nicht der lineare, sondern der monotone Zusammenhang zwischen zwei Variablen ermittelt. \parencite{frank_einfach_2006}\\

Für beide Verfahren gilt, dass der Korrelationskoeffizient $r$ bzw. $r_{Sp}$ stets zwischen -1 und 1 liegt. Bei einem Korrelationskoeffizienten $\approx$ 0 besteht keine Korrelation. Sind $r$ bzw. $r_{Sp}$ kleiner als der Wert 0, existiert eine negative Korrelation, so dass steigende $x$-Werte abfallende $y$-Werte bewirken. Bei einem Korrelationskoeffizienten, der größer als der Wert 0 ist, besteht hingegen eine positive Korrelation, so dass steigende $x$-Werte wachsende $y$-Werte hervorrufen. In einem linearen Modell wird wiederum ein p-Wert erstellt, welcher die Signifikanz der Korrelation zwischen den Variablen repräsentiert. Ein p-Wert, der kleiner als der Wert 0,05 ist, gilt als signifikante Korrelation. \parencite{frank_einfach_2006}\\

Voraussetzung für die Anwendung des Korrelationsverfahrens nach Pearson ist eine Normalverteilung der Messreihen. Um diese Voraussetzung zu prüfen, wird der Shapiro-Wilk-Test verwendet.

\section{Matlab}

Matlab ist eine in den 1970er Jahren in Fortran entwickelte und von The Mathworks vertriebene kommerzielle Software. Sie dient der Analyse und Berechnung numerischer Daten und Problemstellungen sowie der Visualisierung der Ergebnisse. Berechnungen basieren in Matlab (von MATrix LABoratory) auf Matrizen. Aus diesem Grund ist die Nutzung von Matlab im mathematischen, technischen und wissenschaftlichen Kontext stark verbreitet. Insbesondere die Signalverarbeitung kann mit Matlab geeignet umgesetzt werden.\footnote{\url{https://de.mathworks.com/products/matlab.html} und \url{https://de.mathworks.com/solutions.html?s_tid=gn_sol} (Stand: 23.02.2017)}\\

Matlab ähnelt in seiner Syntax zwar der Programmiersprache C, stellt jedoch eine proprietäre Programmier- bzw. Skriptsprache dar. Anwendungen können entweder in Skripten geschrieben oder als atomare Funktionen entwickelt werden, was eine Erstellung der in Matlab charakteristischen Toolboxes unterstützt. Matlab ist darüber hinaus eine Sprache mit dynamischer Typisierung. Dies erhöht die Lesbarkeit des Codes und die Produktivität des Entwicklers. Funktionen sind hierdurch einerseits flexibler, da sie oft weniger Code enthalten als in einer stark typisierten Sprache. Andererseits müssen Funktionen nicht überladen werden, um für unterschiedliche Datentypen zu gelten. Variablen müssen darüber hinaus nicht mit expliziten Datentypen initialisiert werden. Als interpretierte Programmiersprache (oder Skriptsprache) bietet Matlab ferner den Vorteil, dass Code schnell getestet und angewendet werden kann - ohne den zeitaufwendigen Zwischenschritt der Kompilierung. Dies ermöglicht das Testen von Skripten oder Skriptausschnitten mit beliebigen Startpunkten der Ausführung sowie das Testen atomarer Funktionen, ohne eine Main-Klasse ausführen zu müssen, wie z. B. in Java. Eine Erstellung eigenständig lauffähiger Programme ist jedoch durch Erweiterung der Grundfunktionen von Matlab ebenfalls möglich. \parencite{stein_programmieren_2012}\\

Nachteil von Matlab ist zum einen die Speicherverwaltung, da der Standarddatentyp für numerische Variablen double mit einem Speicherplatz von 64 bit ist. Eine starke Typisierung könnte hingegen das Speichermanagement optimieren. Zum anderen stellt Matlab keine kompilierte Sprache dar, so dass in der Grundfunktionalität die Erzeugung lauffähiger Anwendungsprogramme nicht möglich ist. Darüber hinaus dient die statische Codeanalyse lediglich der Überprüfung des Datenflusses, es entfällt jedoch die Überprüfung des Programmcodes zur Übersetzungszeit, so dass Fehler erst bei Ausführung der Funktion erkannt werden.\\

In dieser Arbeit soll für die Anwendung der \acs{TDS}-Analyse Matlab verwendet werden, da die verwendeten Analyseverfahren mathematisch basiert sind und Matlab einerseits als funktionale Sprache für numerische Berechnungen besonders geeignet ist und andererseits Berechnungen einfacher als in kompilierten Sprachen zu implementieren sind. Da im Rahmen dieser Arbeit kein eigenständiges System entwickelt wird, sondern Analyseverfahren angewendet werden sollen, ist Matlab als interpretierte Sprache mit dynamischer Typisierung optimal geeignet, um schnell Zwischenergebnisse zur erzeugen und diese zu verifizieren, auszuwerten und grafisch darzustellen. Aufgrund der Aufgabenstellung sowie des relativ kleinen Untersuchungsdatensatzes (Kapitel \ref{analyse}) kann auch der Nachteil einer weniger effizienten Speicherverwaltung vernachlässigt werden. Da Matlab darüber hinaus unter anderem für die Signalverarbeitung ausgelegt ist, soll die Anwendung des \acs{TDS}-Verfahrens in Matlab umgesetzt werden. Hierfür wird  Matlab in der Version 2015b verwendet.

%benutzt, weil: Flexibilität, Erweiterbarkeit (Toolboxes von Mathworks), und Workspace möglich, numerische Stabilität (kein Datenverlust oder Rundungsfehler), Effizienz und Optimierung der Berechnungen (Beispiel rekursive Fakultät)
%
%überschreiben: bei Vererbung, Änderung des Methodenkörpers
%überladen: Änderung des Methodenheaders (Parameteranzahl oder -datentyp) = Methodensignatur


\section{R}

Open Source, Teil des GNU Projekts
1992 in C und Fortran und später in R selbst entwickelt
seit 1995 unter der GNU General Public License
Pakete
Compiler
interpretierte Sprache
Multiparadigmensprache, objektorientiert und funktional
(dynamisch)
basiert auf Vektoren
Index beginnt bei 1 (wie Matlab)
R requires you to load data sets into memory before processing.
CRAN
All R programs are composed of a series of expressions. These expressions often take
the form of function calls. The R interpreter begins by parsing each expression,
translating syntactic sugar into functional form. Next, R substitutes objects for symbols
(where appropriate). Finally, R evaluates each expression, returning an object.
objektorientert: jedes Objekt in R hat einen Datentypen und jedes Objekt gehört einer Klasse an; eine Funktion in R ist demnach ein Objekt der Klasse \texttt{function}; Symbole und Expressions sind auch Objekte
By default, numbers in R expressions are interpreted as double-precision floatingpoint
numbers (double), even when you enter simple integers.
You can define your own binary operators.
über Editor können Variablen sehr leicht verändert werden durch Aufruf des Inhalts in einem Editor, z. Tabelle) top.5.salaries <- edit(top.5.salaries)
mit R Studio


\parencite{adler_r_2012}

\section{Vorgehen}

%da lediglich die Anwendung verschiedener Verfahren programmiert werden soll, jedoch kein Programm zur häufigen Anwendung, ist keine Kompilierung notwendig und Matlab vor allem aufgrund des schnellen Testens geeignet, um die hiesige Problemstellung zu lösen. 
hauptsächlich werden Skripte (in dieser Arbeit zur einmaligen Ausführung) erstellt